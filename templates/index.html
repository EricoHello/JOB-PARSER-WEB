<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Job History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="p-4">
    <div class="container">
        <h1 class="mb-4">Job Counts History</h1>
        <table class="table table-striped" id="jobsTable">
            <thead>
                <tr>
                    <th>Timestamp</th>
                    <th>LinkedIn</th>
                    <th>Indeed</th>
                    <th>ZipRecruiter</th>
                    <th>Total</th>
                    <th>Search</th>
                    <th>Location</th>
                    <th>Radius</th>
                    <th>Remote</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <h2 class="mt-4">Pi Breakdown</h2>
        <div style="max-width: 300px;">
            <canvas id="jobsPie"></canvas>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </div>
    <script>
        fetch('/api/history')
            .then(res => res.json())
            .then(data => {
                const tbody = document.querySelector('#jobsTable tbody');
                data.forEach(row => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
        <td>${row.timestamp}</td>
        <td>${row.linkedin}</td>
        <td>${row.indeed}</td>
        <td>${row.ziprecruiter}</td>
        <td>${row.total}</td>
        <td>${row.search}</td>
        <td>${row.location}</td>
        <td>${row.radius}</td>
        <td>${row.remote}</td>
      `;
                    tbody.appendChild(tr);
                });
                const latest = data[0];
                const ctx = document.getElementById('jobsPie').getContext('2d');
                new Chart(ctx, {
                    type: 'pie',
                    data: {
                        labels: ['LinkedIn', 'Indeed', 'ZipRecruiter'],
                        datasets: [{
                            data: [latest.linkedin || 0, latest.indeed || 0, latest.ziprecruiter || 0]
                        }]
                    }
                });

            });
    </script>
</body>

</html>